<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Contact Lens Image Upload Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .unit-section {
            margin-bottom: 20px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .unit-section h3 {
            margin-top: 0;
            color: #333;
        }
        .file-input {
            margin: 10px 0;
            padding: 10px;
            border: 2px dashed #ccc;
            border-radius: 5px;
            text-align: center;
        }
        .file-input input[type="file"] {
            margin: 10px 0;
        }
        .preview {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 10px;
        }
        .preview img {
            width: 80px;
            height: 80px;
            object-fit: cover;
            border-radius: 5px;
            border: 1px solid #ddd;
        }
        .submit-btn {
            background: #007bff;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin-top: 20px;
        }
        .submit-btn:hover {
            background: #0056b3;
        }
        .result {
            margin-top: 20px;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            white-space: pre-wrap;
        }
        .success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        .error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        .info {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üî¨ Contact Lens Image Upload Test</h1>
        <p>This test verifies the image upload functionality for contact lens configurations.</p>
        
        <div class="info">
            <strong>üìã Test Instructions:</strong><br>
            1. Select images for different unit packs (10, 20, 30, 60, 90, 180 lenses)<br>
            2. Click "Test Upload" to simulate the API call<br>
            3. Check the FormData payload structure<br>
            4. Verify field names match expected format: unit_images_{unit}[]
        </div>

        <form id="uploadForm">
            <div class="unit-section">
                <h3>üì¶ Unit 10 Lenses</h3>
                <div class="file-input">
                    <input type="file" id="unit_10" multiple accept="image/*">
                    <div id="preview_10" class="preview"></div>
                </div>
            </div>

            <div class="unit-section">
                <h3>üì¶ Unit 20 Lenses</h3>
                <div class="file-input">
                    <input type="file" id="unit_20" multiple accept="image/*">
                    <div id="preview_20" class="preview"></div>
                </div>
            </div>

            <div class="unit-section">
                <h3>üì¶ Unit 30 Lenses</h3>
                <div class="file-input">
                    <input type="file" id="unit_30" multiple accept="image/*">
                    <div id="preview_30" class="preview"></div>
                </div>
            </div>

            <div class="unit-section">
                <h3>üì¶ Unit 60 Lenses</h3>
                <div class="file-input">
                    <input type="file" id="unit_60" multiple accept="image/*">
                    <div id="preview_60" class="preview"></div>
                </div>
            </div>

            <div class="unit-section">
                <h3>üì¶ Unit 90 Lenses</h3>
                <div class="file-input">
                    <input type="file" id="unit_90" multiple accept="image/*">
                    <div id="preview_90" class="preview"></div>
                </div>
            </div>

            <div class="unit-section">
                <h3>üì¶ Unit 180 Lenses</h3>
                <div class="file-input">
                    <input type="file" id="unit_180" multiple accept="image/*">
                    <div id="preview_180" class="preview"></div>
                </div>
            </div>

            <button type="button" class="submit-btn" onclick="testUpload()">üöÄ Test Upload</button>
        </form>

        <div id="result" class="result" style="display: none;"></div>
    </div>

    <script>
        // Handle file input changes and show previews
        const units = ['10', '20', '30', '60', '90', '180'];
        
        units.forEach(unit => {
            const input = document.getElementById(`unit_${unit}`);
            const preview = document.getElementById(`preview_${unit}`);
            
            input.addEventListener('change', function(e) {
                preview.innerHTML = '';
                const files = Array.from(e.target.files);
                
                files.forEach(file => {
                    if (file.type.startsWith('image/')) {
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            const img = document.createElement('img');
                            img.src = e.target.result;
                            img.title = file.name;
                            preview.appendChild(img);
                        };
                        reader.readAsDataURL(file);
                    }
                });
            });
        });

        function testUpload() {
            const formData = new FormData();
            const resultDiv = document.getElementById('result');
            
            // Add form data fields (simulating the real form)
            formData.append('name', 'Test Spherical Configuration');
            formData.append('sub_category_id', '1');
            formData.append('display_name', 'Test Config');
            formData.append('price', '29.99');
            formData.append('is_active', 'true');
            formData.append('available_units', JSON.stringify([10, 20, 30, 60, 90, 180]));
            
            // Add unit prices
            const unitPrices = {
                '10': 32.00,
                '20': 60.00,
                '30': 90.00,
                '60': 170.00,
                '90': 250.00,
                '180': 480.00
            };
            formData.append('unit_prices', JSON.stringify(unitPrices));
            
            // Add existing unit images (empty for this test)
            formData.append('unit_images', JSON.stringify({}));
            
            // Add files for each unit
            let totalFiles = 0;
            units.forEach(unit => {
                const input = document.getElementById(`unit_${unit}`);
                const files = Array.from(input.files);
                
                if (files.length > 0) {
                    files.forEach(file => {
                        formData.append(`unit_images_${unit}[]`, file);
                        totalFiles++;
                    });
                }
            });
            
            // Display FormData contents
            let formDataContent = 'üì§ FormData Contents:\n\n';
            formDataContent += `üî¢ Total Files: ${totalFiles}\n\n`;
            
            for (let [key, value] of formData.entries()) {
                if (value instanceof File) {
                    formDataContent += `üìÅ ${key}: ${value.name} (${value.size} bytes, ${value.type})\n`;
                } else {
                    formDataContent += `üìù ${key}: ${value}\n`;
                }
            }
            
            // Test validation
            const validation = validateFormData(formData);
            
            resultDiv.className = 'result ' + (validation.valid ? 'success' : 'error');
            resultDiv.style.display = 'block';
            resultDiv.textContent = formDataContent + '\n\n' + validation.message;
            
            // Scroll to result
            resultDiv.scrollIntoView({ behavior: 'smooth' });
        }

        function validateFormData(formData) {
            const expectedFields = [
                'name',
                'sub_category_id', 
                'display_name',
                'price',
                'is_active',
                'available_units',
                'unit_prices',
                'unit_images'
            ];
            
            const foundFields = [];
            const missingFields = [];
            const fileFields = [];
            
            for (let [key, value] of formData.entries()) {
                if (expectedFields.includes(key)) {
                    foundFields.push(key);
                } else if (key.startsWith('unit_images_') && key.endsWith('[]')) {
                    fileFields.push(key);
                }
            }
            
            expectedFields.forEach(field => {
                if (!foundFields.includes(field)) {
                    missingFields.push(field);
                }
            });
            
            const valid = missingFields.length === 0 && fileFields.length > 0;
            
            return {
                valid,
                message: valid 
                    ? `‚úÖ Validation passed!\n\n‚úì Found ${foundFields.length} required fields\n‚úì Found ${fileFields.length} file upload fields\n‚úì Ready for backend processing`
                    : `‚ùå Validation failed!\n\n‚ùå Missing fields: ${missingFields.join(', ')}\n‚ùå No file upload fields found`
            };
        }
    </script>
</body>
</html>
