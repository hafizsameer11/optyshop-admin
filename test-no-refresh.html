<!DOCTYPE html>
<html>
<head>
    <title>Test No-Refresh Functionality</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; }
        .error { color: red; }
        .success { color: green; }
        .info { color: blue; }
        pre { background: #f5f5f5; padding: 10px; overflow-x: auto; }
        button { padding: 8px 16px; margin: 5px; }
    </style>
</head>
<body>
    <h1>Test No-Refresh Functionality</h1>
    
    <div class="section">
        <h2>1. Enable Demo Mode</h2>
        <button onclick="enableDemoMode()">Enable Demo Mode</button>
        <button onclick="disableDemoMode()">Disable Demo Mode</button>
        <div id="demo-status"></div>
    </div>
    
    <div class="section">
        <h2>2. Check API Service Demo Mode</h2>
        <button onclick="testLensColorsAPI()">Test Lens Colors API</button>
        <button onclick="testLensTypesAPI()">Test Lens Types API</button>
        <div id="api-result"></div>
    </div>
    
    <div class="section">
        <h2>3. Simulate Modal Operations</h2>
        <button onclick="simulateCreate()">Simulate Create</button>
        <button onclick="simulateUpdate()">Simulate Update</button>
        <button onclick="simulateDelete()">Simulate Delete</button>
        <div id="modal-result"></div>
    </div>
    
    <div class="section">
        <h2>4. Check LocalStorage Data</h2>
        <button onclick="checkStorage()">Check LocalStorage</button>
        <button onclick="clearStorage()">Clear Demo Data</button>
        <div id="storage-result"></div>
    </div>

    <script>
        function enableDemoMode() {
            localStorage.setItem('demo_user', JSON.stringify({
                id: 1,
                name: 'Demo Admin',
                email: 'admin@test.com',
                role: 'admin'
            }));
            localStorage.setItem('admin_token', 'demo-token');
            updateDemoStatus();
        }
        
        function disableDemoMode() {
            localStorage.removeItem('demo_user');
            localStorage.removeItem('admin_token');
            updateDemoStatus();
        }
        
        function updateDemoStatus() {
            const demoUser = localStorage.getItem('demo_user');
            const status = document.getElementById('demo-status');
            
            if (demoUser) {
                status.innerHTML = `<div class="success">✅ Demo Mode Active</div><pre>${demoUser}</pre>`;
            } else {
                status.innerHTML = `<div class="error">❌ Demo Mode Inactive</div>`;
            }
        }
        
        async function testLensColorsAPI() {
            const result = document.getElementById('api-result');
            result.innerHTML = `<div class="info">Testing Lens Colors API...</div>`;
            
            try {
                // Simulate the API service logic
                const isDemoMode = localStorage.getItem('demo_user') !== null;
                const isAuthError = false;
                
                if (isDemoMode || isAuthError) {
                    // Get demo data
                    let demoData = JSON.parse(localStorage.getItem('demo_lens_colors') || 'null');
                    
                    if (!demoData || demoData.length === 0) {
                        demoData = [
                            {
                                id: 1,
                                name: "Clear",
                                slug: "clear",
                                hex_code: "#FFFFFF",
                                description: "Standard clear lens with no tint.",
                                is_active: true,
                                created_at: "2024-01-01T00:00:00Z",
                                updated_at: "2024-01-01T00:00:00Z"
                            },
                            {
                                id: 2,
                                name: "Black",
                                slug: "black",
                                hex_code: "#000000",
                                description: "Solid black lens color.",
                                is_active: true,
                                created_at: "2024-01-01T00:00:00Z",
                                updated_at: "2024-01-01T00:00:00Z"
                            }
                        ];
                        localStorage.setItem('demo_lens_colors', JSON.stringify(demoData));
                    }
                    
                    result.innerHTML = `<div class="success">✅ Demo API Working - Found ${demoData.length} lens colors</div><pre>${JSON.stringify(demoData, null, 2)}</pre>`;
                } else {
                    result.innerHTML = `<div class="error">❌ Would try real API (not available in this test)</div>`;
                }
            } catch (error) {
                result.innerHTML = `<div class="error">❌ Error: ${error.message}</div>`;
            }
        }
        
        async function testLensTypesAPI() {
            const result = document.getElementById('api-result');
            result.innerHTML = `<div class="info">Testing Lens Types API...</div>`;
            
            try {
                const isDemoMode = localStorage.getItem('demo_user') !== null;
                
                if (isDemoMode) {
                    let demoData = JSON.parse(localStorage.getItem('demo_lens_types') || 'null');
                    
                    if (!demoData || demoData.length === 0) {
                        demoData = [
                            {
                                id: 1,
                                name: "Single Vision",
                                slug: "single-vision",
                                description: "Basic single vision lens for one field of vision.",
                                is_active: true,
                                created_at: "2024-01-01T00:00:00Z",
                                updated_at: "2024-01-01T00:00:00Z"
                            }
                        ];
                        localStorage.setItem('demo_lens_types', JSON.stringify(demoData));
                    }
                    
                    result.innerHTML = `<div class="success">✅ Demo API Working - Found ${demoData.length} lens types</div><pre>${JSON.stringify(demoData, null, 2)}</pre>`;
                } else {
                    result.innerHTML = `<div class="error">❌ Would try real API (not available in this test)</div>`;
                }
            } catch (error) {
                result.innerHTML = `<div class="error">❌ Error: ${error.message}</div>`;
            }
        }
        
        function simulateCreate() {
            const result = document.getElementById('modal-result');
            const isDemoMode = localStorage.getItem('demo_user') !== null;
            
            if (isDemoMode) {
                // Simulate creating a new lens color
                const newColor = {
                    id: Date.now(),
                    name: "Test Color",
                    slug: "test-color",
                    hex_code: "#FF0000",
                    description: "Test color for demo",
                    is_active: true,
                    created_at: new Date().toISOString()
                };
                
                // Get existing data
                let demoData = JSON.parse(localStorage.getItem('demo_lens_colors') || '[]');
                demoData.push(newColor);
                localStorage.setItem('demo_lens_colors', JSON.stringify(demoData));
                
                result.innerHTML = `<div class="success">✅ Simulated Create: Added new lens color</div><pre>${JSON.stringify(newColor, null, 2)}</pre>`;
            } else {
                result.innerHTML = `<div class="error">❌ Demo mode not active</div>`;
            }
        }
        
        function simulateUpdate() {
            const result = document.getElementById('modal-result');
            const isDemoMode = localStorage.getItem('demo_user') !== null;
            
            if (isDemoMode) {
                // Get existing data
                let demoData = JSON.parse(localStorage.getItem('demo_lens_colors') || '[]');
                
                if (demoData.length > 0) {
                    // Update first item
                    demoData[0].name = "Updated Color";
                    demoData[0].updated_at = new Date().toISOString();
                    localStorage.setItem('demo_lens_colors', JSON.stringify(demoData));
                    
                    result.innerHTML = `<div class="success">✅ Simulated Update: Updated lens color</div><pre>${JSON.stringify(demoData[0], null, 2)}</pre>`;
                } else {
                    result.innerHTML = `<div class="error">❌ No data to update</div>`;
                }
            } else {
                result.innerHTML = `<div class="error">❌ Demo mode not active</div>`;
            }
        }
        
        function simulateDelete() {
            const result = document.getElementById('modal-result');
            const isDemoMode = localStorage.getItem('demo_user') !== null;
            
            if (isDemoMode) {
                // Get existing data
                let demoData = JSON.parse(localStorage.getItem('demo_lens_colors') || '[]');
                
                if (demoData.length > 0) {
                    const deleted = demoData.shift();
                    localStorage.setItem('demo_lens_colors', JSON.stringify(demoData));
                    
                    result.innerHTML = `<div class="success">✅ Simulated Delete: Removed lens color</div><pre>${JSON.stringify(deleted, null, 2)}</pre>`;
                } else {
                    result.innerHTML = `<div class="error">❌ No data to delete</div>`;
                }
            } else {
                result.innerHTML = `<div class="error">❌ Demo mode not active</div>`;
            }
        }
        
        function checkStorage() {
            const result = document.getElementById('storage-result');
            const keys = [];
            
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key.startsWith('demo_') || key === 'admin_token') {
                    const value = localStorage.getItem(key);
                    keys.push({ key, value: value.substring(0, 100) + (value.length > 100 ? '...' : '') });
                }
            }
            
            if (keys.length === 0) {
                result.innerHTML = `<div class="error">❌ No demo/auth data found</div>`;
            } else {
                let html = `<div class="success">✅ Found ${keys.length} demo/auth items:</div><pre>`;
                keys.forEach(item => {
                    html += `${item.key}: ${item.value}\n`;
                });
                html += '</pre>';
                result.innerHTML = html;
            }
        }
        
        function clearStorage() {
            const keysToRemove = [];
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key.startsWith('demo_') || key === 'admin_token') {
                    keysToRemove.push(key);
                }
            }
            
            keysToRemove.forEach(key => localStorage.removeItem(key));
            
            const result = document.getElementById('storage-result');
            result.innerHTML = `<div class="info">ℹ️ Cleared ${keysToRemove.length} demo/auth items</div>`;
            updateDemoStatus();
        }
        
        // Auto-check on load
        window.onload = function() {
            updateDemoStatus();
            checkStorage();
        };
    </script>
</body>
</html>
